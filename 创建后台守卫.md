## 实现前台账号分离

#### 修改配置文件

在`config`的`auth.php`

这是守卫者的代码块  web是默认的守卫者  可以当做前台的守卫

```php
'guards' => [
        'web' => [
            'driver' => 'session',
            'provider' => 'users',
        ],
    //在这里加一个后台守卫者  
		'admin' => [
            'driver' => 'session',
            'provider' => 'admins',    //指定providers的admins表
        ],
        'api' => [
            'driver' => 'token',
            'provider' => 'users',
            'hash' => false,
        ],
    ],
```

**作用**：查找用户和验证用户的方法  



对数据的操作都是使用模型，接着创建模型：

```php
artisan make:model Admin -fm
```

**-fm**：直接再生成模型工厂和数据迁移

建议直接使用该语句创建 因为创建的表是带s的

`Admin.php`模型会自动关联`admins`表



接着回到配置文件,指定Admin表和模型

```php
'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => App\User::class,
        ],
    	//admins 写的是创建表的name 不是模型admin
    	'admins' => [
            'driver' => 'eloquent',
            'model' => App\Admin::class,   //指定模型
        ],

        // 'users' => [
        //     'driver' => 'database',
        //     'table' => 'users',
        // ],
    ],
```



#### 功能描述

当时使用命令验证用户的时候，就可以指定表

```php
Auth::user('admin')->check()    // 使用Admin模型进行验证 默认是web 就是User模型
```



#### 模型工厂

内容可以直接复制`UserFactory`的

```php
return [
        'name' => $faker->name,
        'password' => bcrypt('123456'),
    	'nickname' => $faker->name,
        'remember_token' => Str::random(10),
    ];
```



#### 编写迁移文件

```php
Schema::create('admins', function (Blueprint $table) {
            $table->bigIncrements('id');
            $table->string('name');
            $table->string('password');
    		$table->String('nickname')->default('')->comment('昵称');
            $table->rememberToken();
            $table->timestamps();
});
```



#### 创建数据填充

```php
artisan make:seeder AdminSeeder
```

生成后调用模型工厂创建数据，并设置第一个为测试账号

```php
public function run()
    {
         $users = factory(App\Admin::class,6)->create();
         $user = $users[0];
         $user->name = 'admin';
         $user->nickname = '管理员啊';
         $user->save();
    }
```

在`DatebaseSeeder.php`注册数据填充文件

```php
 $this->call(AdminSeeder::class);
```



#### 执行数据迁移和填充

```php
artisan migrate:refresh --seed
```

**如果执行不了就去homestead上执行**



#### 后台登录模板

把后台登录模板粘到Admin模块下的views里面

分别是`auth`文件夹 和 `layouts`文件夹下的`app.blade.php`

然后把原来的登录验证控制`Auth`粘到`Admin`模块控制器下

需要`Auth`里面的控制器文件的命名空间都改成

```php
namespace Modules\Admin\Http\Controllers\下
```



#### 指定路由

```php
Route::group(['middleware' => 'web', 'prefix' => 'admin', 'namespace' => 'Modules\Admin\Http\Controllers'], function()
{
    Auth::routes();    // 这样调用的是admin路径下的登录
});
```



#### 查看Auth控制器方法

按`Ctrl`键点击导进的类

例：查询`LoginController.php`的方法 就点击`AuthenticatesUsers`

```php
use AuthenticatesUsers
```

**里面的方法都是原生的不建议直接修改**

**可以在`LoginController.php`进行方法重写，而实现其他功能**

重写后就覆盖掉原生的方法

`Ctrl+O` 可以快速查看当前控制器的所有方法

点击某个方法名就是重写该方法



#### 修改登录控制器

重写`LoginController.php`下的`showLoginForm`方法

**重写内容**

```php
public function showLoginForm()
{
     return view('admin::auth.login');
}
```

不重写会直接去根目录下找`auth.login`登录视图























